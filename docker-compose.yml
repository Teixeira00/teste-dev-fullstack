version: "3.8"

services:
  app:
    build:
      context: ./backend
    container_name: laravel-app
    working_dir: /var/www
    volumes:
      - ./backend:/var/www
    ports:
      - "8000:8000"
    environment:
      - DB_CONNECTION=pgsql
      - DB_HOST=db.vvntnimgjbwmqdhzfyen.supabase.co
      - DB_PORT=5432
      - DB_DATABASE=postgres
      - DB_USERNAME=postgres
      - DB_PASSWORD=ZvrvCvK1QCcI1Q0l
      - APP_KEY=base64:nq37KyUJfNqHtY7U7O4uQkyBzaifyEGmiF/6h/f8PwQ=
      - APP_ENV=local
    network_mode: "host"  # Isso forÃ§a o container a usar a rede do host
    command: >
      sh -c "
        cp .env.example .env &&
        composer install &&
        php artisan key:generate &&
        until php artisan migrate; do sleep 3; done &&
        php artisan serve --host=0.0.0.0 --port=8000
      "


  frontend:
    build:
      context: ./frontend
    container_name: vue-frontend
    ports:
      - "5173:5173"
    command: npm run dev -- --host=0.0.0.0 --port=5173

networks:
  app-network:
    external: true
# version: "3.8"

# services:
#   app:
#     build:
#       context: ./backend
#     container_name: laravel-app
#     working_dir: /var/www
#     volumes:
#       - ./backend:/var/www
#     ports:
#       - "8000:8000"
#     environment:
#       - DB_CONNECTION=pgsql
#       - DB_HOST=db.vvntnimgjbwmqdhzfyen.supabase.co
#       - DB_PORT=5432
#       - DB_DATABASE=postgres
#       - DB_USERNAME=postgres
#       - DB_PASSWORD=ZvrvCvK1QCcI1Q0l
#       - APP_KEY=base64:nq37KyUJfNqHtY7U7O4uQkyBzaifyEGmiF/6h/f8PwQ=
#       - APP_ENV=local
#     network_mode: "host"
#     command: >
#       sh -c "
#         composer install &&
#         php artisan key:generate &&
#         until php artisan migrate; do sleep 3; done &&
#         php artisan serve --host=0.0.0.0 --port=8000
#       "

#   frontend:
#     build:
#       context: ./frontend
#     container_name: vue-frontend
#     ports:
#       - "5173:5173"
#     command: npm run dev -- --host=0.0.0.0 --port=5173

# networks:
#   app-network:
#     external: true
